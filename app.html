<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Trading Simulator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="scratch.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 20px;
    text-align: center;
}

h1 { color: #002E5D; margin-top: 20px; }

#gameContainer {
    margin: auto;
    width: 95%;
    max-width: 900px;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

#balance, #timer, #gameContainer p {
    font-size: 20px;
    margin: 10px 0;
    color: black;
}

button {
    margin: 5px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
}

#controls {
    margin-top: 15px;
    margin-bottom: 15px;
}

canvas {
    margin-top: 20px;
}
</style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="index.html">Cosmo</a>
    <div>
      <a class="text-white me-3" href="resume.html">Resume</a>
      <a class="text-white me-3" href="scratch.html">Scratch</a>
      <a class="text-white" href="app.html">Web App</a>
    </div>
  </div>
</nav>

<h1>Mini Trading Simulator</h1>
<div id="gameContainer">
    <p>Start with $100,000. Try to make as much as possible in 60 seconds!</p>

    <div id="balance">Balance: $100,000 | Position: $0</div>
    <div id="timer">Time left: 60s</div>

    <div id="controls">
        <button id="startBtn" class="btn btn-primary">Start Game</button>
        <button id="buyBtn" class="btn btn-success" disabled>Buy $5,000</button>
        <button id="sellBtn" class="btn btn-warning" disabled>Sell $5,000</button>
        <button id="sellAllBtn" class="btn btn-danger" disabled>Sell All</button>
    </div>

    <canvas id="chart" width="800" height="400"></canvas>
</div>

<script>
// Game variables
let balance = 100000;
let position = 0;
let price = 100000;
let priceHistory = [];
let accountHistory = [];
let timeLeft = 60;
let gameInterval;

// Chart setup
const ctx = document.getElementById('chart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [],
        datasets: [
            {
                label: 'Price',
                type: 'bar',
                data: [],
                backgroundColor: [],
                barPercentage: 0.4,  // narrower bars
                categoryPercentage: 0.6
            },
            {
                label: 'Account Value',
                type: 'line',
                data: [],
                borderColor: 'blue',
                borderWidth: 2,
                fill: false,
                tension: 0.3,
                yAxisID: 'y1'
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true },
            tooltip: {
                callbacks: {
                    label: function(context){
                        return context.datasetIndex === 0 
                            ? `Price: $${context.raw.toFixed(2)}` 
                            : `Account: $${context.raw.toFixed(2)}`;
                    }
                }
            }
        },
        scales: {
            x: { ticks: { display: false } },
            y: {
                type: 'linear',
                position: 'left',
                title: { display: true, text: 'Price' },
            },
            y1: {
                type: 'linear',
                position: 'right',
                title: { display: true, text: 'Account Value' },
                grid: { drawOnChartArea: false }
            }
        }
    }
});

// Generate dramatic jumps Â±20%-80%
function generatePrice(lastPrice){
    const changePercent = 0.2 + Math.random() * 0.6; // 20%-80%
    const direction = Math.random() < 0.5 ? -1 : 1;
    const newPrice = lastPrice + lastPrice * changePercent * direction;
    return Math.max(1000, newPrice);
}

// Update chart and balance
function updateChart(){
    price = generatePrice(price);
    priceHistory.push(price);
    accountHistory.push(balance + position * price);

    if(priceHistory.length > 30){
        priceHistory.shift();
        accountHistory.shift();
    }

    chart.data.labels = priceHistory.map((_, i) => i + 1);
    chart.data.datasets[0].data = priceHistory;
    chart.data.datasets[0].backgroundColor = priceHistory.map((p, i) => i===0 ? 'green' : p >= priceHistory[i-1] ? 'green' : 'red');
    chart.data.datasets[1].data = accountHistory;
    chart.update();

    document.getElementById('balance').innerText = `Balance: $${balance.toFixed(2)} | Position: $${(position*price).toFixed(2)}`;
}

// Start Game
document.getElementById('startBtn').onclick = () => {
    balance = 100000; position = 0; price = 100000; priceHistory = []; accountHistory = []; timeLeft = 60;
    document.getElementById('buyBtn').disabled = false;
    document.getElementById('sellBtn').disabled = false;
    document.getElementById('sellAllBtn').disabled = false;
    document.getElementById('startBtn').disabled = true;

    updateChart();
    gameInterval = setInterval(() => {
        timeLeft -= 3;
        if(timeLeft < 0) timeLeft = 0;
        document.getElementById('timer').innerText = `Time left: ${timeLeft}s`;
        updateChart();

        if (timeLeft <= 0){
            clearInterval(gameInterval);
            if(position > 0){ balance += position*price; position = 0; }
            document.getElementById('buyBtn').disabled = true;
            document.getElementById('sellBtn').disabled = true;
            document.getElementById('sellAllBtn').disabled = true;
            document.getElementById('startBtn').disabled = false;
            updateChart();
            alert(`Time's up! Final balance: $${balance.toFixed(2)}`);
        }
    }, 3000);
};

// Buy $5,000
document.getElementById('buyBtn').onclick = () => {
    if(balance >= 5000){
        balance -= 5000;
        position += 5000 / price;
        updateChart();
    }
};

// Sell $5,000
document.getElementById('sellBtn').onclick = () => {
    const sellAmount = Math.min(position*price, 5000);
    if(position > 0 && sellAmount > 0){
        const sellUnits = sellAmount / price;
        position -= sellUnits;
        balance += sellAmount;
        updateChart();
    }
};

// Sell All
document.getElementById('sellAllBtn').onclick = () => {
    if(position > 0){
        balance += position * price;
        position = 0;
        updateChart();
    }
};
</script>
</body>
</html>
